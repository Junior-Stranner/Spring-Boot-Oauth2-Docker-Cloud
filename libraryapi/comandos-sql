create table autor(
  id uuid not null primary key,
  nome varchar(100) not null,
  data_nascimento date not null,
  nacionalidade varchar(50) not null,
  data_cadastro timestamp,
  data_atualizacao timestamp);

create table livro (
   id uuid not null primary key,
   isbn varchar(20) not null unique,
   titulo varchar(150) not null,
   data_publicacao date not null,
   genero varchar(30) not null,
   preco numeric(18,2),
   data_cadastro timestamp,
   data_atualizacao timestamp,
   id_autor uuid not null references autor(id),
   constraint chk_genero check (genero in ('FICCAO', 'FANTASIA', 'MISTERIO','ROMANCE', 'BIOGRAFIA', 'CIENCIA') )
);

create table usuario(
    id uuid not null primary key,
    login varchar(20) not null unique,
    senha varchar(300) not null,
	email varchar(150) not null,
    roles varchar[]
);

CREATE TABLE client(
   id uuid not null primary key,
   client_id varchar(150) not null,
   client_secret varchar(400) not null,
   redirect_uri varchar(200) not null,
   scope varchar(50)
);

create table usuario(
    id uuid not null primary key,
    login varchar(20) not null unique,
    senha varchar(300) not null,
    email varchar(150) not null,
    roles varchar[] not null default '{}'
);

alter table autor
add column id_usuario uuid;

alter table autor
add constraint fk_autor_usuario
foreign key (id_usuario) references usuario(id)
on delete set null;

update usuario
set roles = ARRAY['ROLE_GERENTE']
where login = 'gerente'


select * from usuario where login = 'gerente';

delete from usuario
where login = 'gerente';

select * from autor
where id_usuario = (select id from usuario where login = 'gerente');

select a.*, u.login
from autor a
join usuario u on u.id = a.id_usuario
where u.login = 'gerente';

insert into usuario (id, login, email, senha, roles)
values (
  gen_random_uuid(),
  'gerente',
  'gerente@teste.com',
  '$2a$13$ywcSDX60NxgT4FmnFQBjuOVrdy86hmlrHL6MsHH3xs1fEfDXM6v/.',
  '{"ROLE_GERENTE"}'
);


